# КПО ДЗ 2


## Общее описание
Проект реализует библиотеку и консольное приложение для управления финансами. 

Поддерживается:
- Управление банковскими счетами, категориями и финансовыми операциями
- Экспорт данных в различные форматы (CSV, JSON, YAML)
- Просмотр логов действия пользователя в формате `Время - Действие`, они автоматически сохраняются в файле logs.txt в корне проекта

## Структура проекта

```
FinanceAccount/
 FinanceAccountLibrary/
    Export/                 # Экспорт данных в различных форматах
    Facades/                # Фасады для работы с бизнес-логикой
    factories/              # Фабрики для создания объектов
    models/                 # Модели данных (BankAccount, Category, Operation)
    repository/             # Интерфейсы репозиториев
 FinanceApplication/
    commands/               # Команды для пользовательского интерфейса
    Factories/              # Фабрики декораторов
    Repositories/sqlite/    # Реализации репозиториев для SQLite
    services/               # Сервисы приложения
```



### Про модели
- Все основные сущности наследуются от абстрактного класса Entity( в котором есть поле ID, чтобы избежать дублирование кода)
- Модели также реализуют интерфейс IExportable, для поддержки экспорта их
- Все модели создаются с помощью фабрик(которые сами указывают время создания объекта)


### Почему реализован SOLID
- Single Responsibility: Каждый класс модели имеет одну ответственность, каждый фасад работает только с одной моделью. (Например, OperationProcessingFacade - работают только с операциями)
- Open/Closed Principle: Интерфейсы IExportVisitor и IExportable позволяют добавлять новые форматы экспорта без изменения основного кода; Также интерфейсы репозиториев легко позволяют менять реализацию работы с БД без изменения другого кода
- LSP: Подклассы CsvExporter, JsonExporter, YamlExporter спокойно заменяют базовый класс ExporterBase
- Interface Segregation: Интерфэйсы IExportVisitor и IExportable разбиты на несколько интерфэйсов.  Репозитории содержат только методы которые связаны с одной сущностью
- Dependency Inversion: Взаимодействие между моделями и репозиториями осуществляется с помощью интерфэйсов. 

### Почему реализован GRASP
- Controller: Класс Application выполняет роль контроллера, обрабатывая пользовательский ввод и координируя выполнение команд. 
- Creator: Фабричные классы (BankAccountFactory, CategoryFactory, OperationFactory) отвечают за создание экземпляров объектов, инкапсулируя логику создания и обеспечивая правильную инициализацию объектов.
- Expert: Репозитории (BankAccountRepository, CategoryRepository, OperationRepository) являются экспертами в области работы с базой данных и работают только со своими объектами, не выполняя операции с другими типами.
- High Cohesion: Классы и модули спроектированы с высокой связностью - каждый класс имеет четко определенную ответственность. Например, классы экспорта отвечают только за экспорт данных, фасады управляют конкретными доменными сущностями, а фабрики занимаются созданием объектов.
- Low Coupling: Система демонстрирует слабую связанность благодаря использованию интерфейсов. Фасады зависят от интерфейсов репозиториев, а не от конкретных реализаций. Экспорт данных использует интерфейсы IExportVisitor и IExportable, что позволяет компонентам взаимодействовать без жесткой привязки друг к другу.
- Polymorphism: Используется паттерн посетитель (Visitor) для экспорта данных. Различные экспортеры (CsvExporter, JsonExporter, YamlExporter) реализуют общий интерфейс IExportVisitor, но по-разному обрабатывают одни и те же объекты, обеспечивая полиморфное поведение.
- Indirection: Фасадные классы обеспечивают промежуточный уровень между пользовательским интерфейсом и слоем данных. Они скрывают сложность взаимодействия с репозиториями и обеспечивают четкое разделение ответственности между слоями приложения.
- Pure Fabrication: Классы фабрик (BankAccountFactory, CategoryFactory, OperationFactory) являются pure fabrication, они создают объекты, но не выполняют никаких операций с другими типами. 


## Паттерны проектирования
- **Factory method**: `/factories` - имеются фабрики дял создания банковского аккаунта, категорий и операций 
- - Нужны для корректного создания объекта, а также для скрытия создания времени создания объекта
- **Facade**: `/facades` - имеются фасад, который позволяют выполнять все CRUD операции с определенными объектами
- - Они облегчают сложность и уменьшают количество интерфейсов для выполения бизнес логики
- **Command**:  `/commands` - Икапсулируют запрос как объект, а также облегчают сложность других объектов. Также дают поддержку логирования декорирования и даже создания очереди в будущем
- **Decorator**: `/commands/LoggingCommandDecorator.cs` Позволяют написать один класс для логирования, чтобы потом оборачивать все команды, и реализовать просто логгирование без изменение остальных команд
- **Repository**: `/Repositories` - Инкапсулирует логику доступа к моделям и централизует её, абстрагируя приложение от деталей хранения(то есть позволяет в дальнешем легко менять БД или даже по другому хранить)
- **Visitor**:  `/Export` - Реализованы интерфейсы IExportable, которые потом реализованы моделями и IExportVisitor, который добавляет новую операцию(экспорт) к группе классов без изменения самих классов
- **Template Method**: `/commands/BaseExportCommand.cs` - Реализован шаблонный метод Execute() в классе Команды который потом наследуется в трех новых командах под каждую модель. Позволяет один раз реализовать интерфейс экспорта, а дальше легко подключать к любому типу реализующий интерфейс IExportable
- **Singleton**: `/services/CommandLogger.cs`: Гарантирует, что у класса есть только один экземпляр, и предоставляет к нему глобальную точку доступа. Логгирование будет проводится одним единственным сервисом
- **Dependency Injection** `Program.cs`: Все сервисы инициализируются в DI контейнере, и DI контейнер инициализирует все сервисы  


## DI-контейнер
Используется встроенный DI-контейнер Microsoft.Extensions.DependencyInjection. Зависимости регистрируются и внедряются через конструкторы классов.

## Запуск

- Скопируйте проект
- Убедитесь что у вас установлен dotnet
- В консоле откройте проект FinanceApplication: `cd FinanceApplication`
- Восстановите зависимости: `dotnet restore`
- Запустите: `dotnet run`